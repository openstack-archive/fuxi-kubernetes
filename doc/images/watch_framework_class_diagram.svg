<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="504px" preserveAspectRatio="none" style="width:549px;height:504px;" version="1.1" viewBox="0 0 549 504" width="549px" zoomAndPan="magnify"><defs><filter height="300%" id="f1jcja3mlv4fap" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="314" x="121.5" y="16.708">Fuxi-Kubernetes Watch Framework</text><!--class DeltaFIFO--><rect fill="#FEFECE" filter="url(#f1jcja3mlv4fap)" height="163.2422" id="DeltaFIFO" style="stroke: #A80036; stroke-width: 1.5;" width="154" x="130.5" y="28.9531"/><ellipse cx="173.85" cy="44.9531" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M176.1938,40.625 L176.3656,40.7031 C176.5844,40.3906 176.7875,40.2969 177.0844,40.2969 C177.3813,40.2969 177.6625,40.4375 177.8188,40.7031 C177.9125,40.8594 177.9281,40.9844 177.9281,41.4219 L177.9281,42.8438 C177.9281,43.2656 177.8969,43.4531 177.7875,43.6094 C177.6156,43.8281 177.35,43.9688 177.0844,43.9688 C176.8656,43.9688 176.6313,43.8594 176.4906,43.7188 C176.35,43.5938 176.3188,43.4688 176.2563,43.0625 C176.1625,42.6563 175.9906,42.4375 175.5063,42.1563 C175.0375,41.9063 174.4281,41.75 173.85,41.75 C172.1156,41.75 170.8656,43.0625 170.8656,44.8438 L170.8656,45.9375 C170.8656,47.6406 172.1625,48.7344 174.2094,48.7344 C174.975,48.7344 175.6625,48.6094 176.0844,48.3438 C176.2719,48.25 176.2719,48.25 176.725,47.7656 C176.9125,47.5781 177.1156,47.5 177.3344,47.5 C177.8031,47.5 178.1938,47.8906 178.1938,48.3438 C178.1938,48.7344 177.8656,49.1875 177.2875,49.5938 C176.5375,50.1406 175.3813,50.4375 174.1625,50.4375 C171.2719,50.4375 169.1625,48.5469 169.1625,45.9688 L169.1625,44.8438 C169.1625,42.125 171.1625,40.0469 173.7875,40.0469 C174.6625,40.0469 175.2563,40.1875 176.1938,40.625 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="59" x="194.15" y="49.1074">DeltaFIFO</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="131.5" x2="283.5" y1="60.9531" y2="60.9531"/><ellipse cx="141.5" cy="72.8555" fill="none" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="98" x="150.5" y="75.1636">_items dict of list</text><ellipse cx="141.5" cy="85.6602" fill="none" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="53" x="150.5" y="87.9683">_queue []</text><ellipse cx="141.5" cy="98.4648" fill="none" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="128" x="150.5" y="100.7729">_known_objects Cache</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="131.5" x2="283.5" y1="107.3672" y2="107.3672"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="46" x="136.5" y="121.5776">add(obj)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="60" x="136.5" y="134.3823">delete(obj)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="64" x="136.5" y="147.187">update(obj)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="74" x="136.5" y="159.9917">replace(objs)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="29" x="136.5" y="172.7964">pop()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="55" x="136.5" y="185.6011">keyof(obj)</text><!--class Cache--><rect fill="#FEFECE" filter="url(#f1jcja3mlv4fap)" height="163.2422" id="Cache" style="stroke: #A80036; stroke-width: 1.5;" width="142" x="319.5" y="28.9531"/><ellipse cx="366.75" cy="44.9531" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M369.0938,40.625 L369.2656,40.7031 C369.4844,40.3906 369.6875,40.2969 369.9844,40.2969 C370.2813,40.2969 370.5625,40.4375 370.7188,40.7031 C370.8125,40.8594 370.8281,40.9844 370.8281,41.4219 L370.8281,42.8438 C370.8281,43.2656 370.7969,43.4531 370.6875,43.6094 C370.5156,43.8281 370.25,43.9688 369.9844,43.9688 C369.7656,43.9688 369.5313,43.8594 369.3906,43.7188 C369.25,43.5938 369.2188,43.4688 369.1563,43.0625 C369.0625,42.6563 368.8906,42.4375 368.4063,42.1563 C367.9375,41.9063 367.3281,41.75 366.75,41.75 C365.0156,41.75 363.7656,43.0625 363.7656,44.8438 L363.7656,45.9375 C363.7656,47.6406 365.0625,48.7344 367.1094,48.7344 C367.875,48.7344 368.5625,48.6094 368.9844,48.3438 C369.1719,48.25 369.1719,48.25 369.625,47.7656 C369.8125,47.5781 370.0156,47.5 370.2344,47.5 C370.7031,47.5 371.0938,47.8906 371.0938,48.3438 C371.0938,48.7344 370.7656,49.1875 370.1875,49.5938 C369.4375,50.1406 368.2813,50.4375 367.0625,50.4375 C364.1719,50.4375 362.0625,48.5469 362.0625,45.9688 L362.0625,44.8438 C362.0625,42.125 364.0625,40.0469 366.6875,40.0469 C367.5625,40.0469 368.1563,40.1875 369.0938,40.625 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="39" x="387.25" y="49.1074">Cache</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="320.5" x2="460.5" y1="60.9531" y2="60.9531"/><ellipse cx="330.5" cy="72.8555" fill="none" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="62" x="339.5" y="75.1636">_items dict</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="320.5" x2="460.5" y1="81.7578" y2="81.7578"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="46" x="325.5" y="95.9683">add(obj)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="60" x="325.5" y="108.7729">delete(obj)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="64" x="325.5" y="121.5776">update(obj)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="74" x="325.5" y="134.3823">replace(objs)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="43" x="325.5" y="147.187">get(obj)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="89" x="325.5" y="159.9917">get_by_key(key)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="57" x="325.5" y="172.7964">list_keys()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="130" x="325.5" y="185.6011">set_key_func(key_func)</text><!--class Producer--><rect fill="#FEFECE" filter="url(#f1jcja3mlv4fap)" height="124.8281" id="Producer" style="stroke: #A80036; stroke-width: 1.5;" width="193" x="14" y="251.9531"/><ellipse cx="77.75" cy="267.9531" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M80.0938,263.625 L80.2656,263.7031 C80.4844,263.3906 80.6875,263.2969 80.9844,263.2969 C81.2813,263.2969 81.5625,263.4375 81.7188,263.7031 C81.8125,263.8594 81.8281,263.9844 81.8281,264.4219 L81.8281,265.8438 C81.8281,266.2656 81.7969,266.4531 81.6875,266.6094 C81.5156,266.8281 81.25,266.9688 80.9844,266.9688 C80.7656,266.9688 80.5313,266.8594 80.3906,266.7188 C80.25,266.5938 80.2188,266.4688 80.1563,266.0625 C80.0625,265.6563 79.8906,265.4375 79.4063,265.1563 C78.9375,264.9063 78.3281,264.75 77.75,264.75 C76.0156,264.75 74.7656,266.0625 74.7656,267.8438 L74.7656,268.9375 C74.7656,270.6406 76.0625,271.7344 78.1094,271.7344 C78.875,271.7344 79.5625,271.6094 79.9844,271.3438 C80.1719,271.25 80.1719,271.25 80.625,270.7656 C80.8125,270.5781 81.0156,270.5 81.2344,270.5 C81.7031,270.5 82.0938,270.8906 82.0938,271.3438 C82.0938,271.7344 81.7656,272.1875 81.1875,272.5938 C80.4375,273.1406 79.2813,273.4375 78.0625,273.4375 C75.1719,273.4375 73.0625,271.5469 73.0625,268.9688 L73.0625,267.8438 C73.0625,265.125 75.0625,263.0469 77.6875,263.0469 C78.5625,263.0469 79.1563,263.1875 80.0938,263.625 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="57" x="98.25" y="272.1074">Producer</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="15" x2="206" y1="283.9531" y2="283.9531"/><ellipse cx="25" cy="295.8555" fill="none" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="159" x="34" y="298.1636">_watch_resouce_type object</text><ellipse cx="25" cy="308.6602" fill="none" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="167" x="34" y="310.9683">_lister_watcher ListerWatcher</text><ellipse cx="25" cy="321.4648" fill="none" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="106" x="34" y="323.7729">_watch_timeout int</text><ellipse cx="25" cy="334.2695" fill="none" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="93" x="34" y="336.5776">_store DeltaFIFO</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="15" x2="206" y1="343.1719" y2="343.1719"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="35" x="20" y="357.3823">start()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="33" x="20" y="370.187">stop()</text><polygon fill="#FBFB77" filter="url(#f1jcja3mlv4fap)" points="6,436.9531,6,492.3516,215,492.3516,215,446.9531,205,436.9531,6,436.9531" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#FBFB77" points="6,436.9531,6,492.3516,215,492.3516,215,446.9531,205,436.9531,114.5,436.9531,110.5,377.3611,106.5,436.9531,6,436.9531" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="205" x2="205" y1="436.9531" y2="446.9531"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="215" x2="205" y1="446.9531" y2="446.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="188" x="12" y="454.02">ListerWatcher = namedtuple(</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="20" y="469.1528">'ListerWatcher',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="74" x="20" y="484.2856">'list, watch')</text><!--class Consumer--><rect fill="#FEFECE" filter="url(#f1jcja3mlv4fap)" height="112.0234" id="Consumer" style="stroke: #A80036; stroke-width: 1.5;" width="296" x="242.5" y="258.4531"/><ellipse cx="354.75" cy="274.4531" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M357.0938,270.125 L357.2656,270.2031 C357.4844,269.8906 357.6875,269.7969 357.9844,269.7969 C358.2813,269.7969 358.5625,269.9375 358.7188,270.2031 C358.8125,270.3594 358.8281,270.4844 358.8281,270.9219 L358.8281,272.3438 C358.8281,272.7656 358.7969,272.9531 358.6875,273.1094 C358.5156,273.3281 358.25,273.4688 357.9844,273.4688 C357.7656,273.4688 357.5313,273.3594 357.3906,273.2188 C357.25,273.0938 357.2188,272.9688 357.1563,272.5625 C357.0625,272.1563 356.8906,271.9375 356.4063,271.6563 C355.9375,271.4063 355.3281,271.25 354.75,271.25 C353.0156,271.25 351.7656,272.5625 351.7656,274.3438 L351.7656,275.4375 C351.7656,277.1406 353.0625,278.2344 355.1094,278.2344 C355.875,278.2344 356.5625,278.1094 356.9844,277.8438 C357.1719,277.75 357.1719,277.75 357.625,277.2656 C357.8125,277.0781 358.0156,277 358.2344,277 C358.7031,277 359.0938,277.3906 359.0938,277.8438 C359.0938,278.2344 358.7656,278.6875 358.1875,279.0938 C357.4375,279.6406 356.2813,279.9375 355.0625,279.9375 C352.1719,279.9375 350.0625,278.0469 350.0625,275.4688 L350.0625,274.3438 C350.0625,271.625 352.0625,269.5469 354.6875,269.5469 C355.5625,269.5469 356.1563,269.6875 357.0938,270.125 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="63" x="375.25" y="278.6074">Consumer</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="243.5" x2="537.5" y1="290.4531" y2="290.4531"/><ellipse cx="253.5" cy="302.3555" fill="none" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="78" x="262.5" y="304.6636">_cache Cache</text><ellipse cx="253.5" cy="315.1602" fill="none" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="81" x="262.5" y="317.4683">_fifo DeltaFIFO</text><ellipse cx="253.5" cy="327.9648" fill="none" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="270" x="262.5" y="330.2729">_resource_event_handler ResouceEventHandler</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="243.5" x2="537.5" y1="336.8672" y2="336.8672"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="35" x="248.5" y="351.0776">start()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="33" x="248.5" y="363.8823">stop()</text><polygon fill="#FBFB77" filter="url(#f1jcja3mlv4fap)" points="259.5,436.9531,259.5,492.3516,521.5,492.3516,521.5,446.9531,511.5,436.9531,259.5,436.9531" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#FBFB77" points="259.5,436.9531,259.5,492.3516,521.5,492.3516,521.5,446.9531,511.5,436.9531,394.5,436.9531,390.5,370.5631,386.5,436.9531,259.5,436.9531" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="511.5" x2="511.5" y1="436.9531" y2="446.9531"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="521.5" x2="511.5" y1="446.9531" y2="446.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="241" x="265.5" y="454.02">ResouceEventHandler = namedtuple(</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="150" x="273.5" y="469.1528">'ResouceEventHandler',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="205" x="273.5" y="484.2856">'on_add, on_delete, on_update')</text><!--link DeltaFIFO to Cache--><path d="M297.721,110.4531 C304.953,110.4531 312.186,110.4531 319.418,110.4531 " fill="none" id="DeltaFIFO-Cache" style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><polygon fill="#FFFFFF" points="284.703,110.4531,290.703,114.4531,296.703,110.4531,290.703,106.4531,284.703,110.4531" style="stroke: #A80036; stroke-width: 1.0;"/><!--link DeltaFIFO to Producer--><path d="M168.745,192.1601 C161.208,207.8541 153.344,224.2311 145.922,239.6881 " fill="none" id="DeltaFIFO-Producer" style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><polygon fill="#FFFFFF" points="140.078,251.8571,146.281,248.1799,145.2724,241.0397,139.0694,244.7169,140.078,251.8571" style="stroke: #A80036; stroke-width: 1.0;"/><!--link DeltaFIFO to Consumer--><path d="M280.615,192.1601 C297.583,210.8891 315.431,230.5901 331.693,248.5401 " fill="none" id="DeltaFIFO-Consumer" style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><polygon fill="#FFFFFF" points="340.548,258.3151,339.4838,251.183,332.491,249.4221,333.5552,256.5543,340.548,258.3151" style="stroke: #A80036; stroke-width: 1.0;"/><!--link Cache to Consumer--><path d="M390.5,192.1601 C390.5,209.7621 390.5,228.2221 390.5,245.2811 " fill="none" id="Cache-Consumer" style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><polygon fill="#FFFFFF" points="390.5,258.3151,394.5,252.3151,390.5,246.3151,386.5,252.3151,390.5,258.3151" style="stroke: #A80036; stroke-width: 1.0;"/><!--
@startuml
title Fuxi-Kubernetes Watch Framework


class DeltaFIFO {
  +_items dict of list
  +_queue []
  +_known_objects Cache
  add(obj)
  delete(obj)
  update(obj)
  replace(objs)
  pop()
  keyof(obj)
}
DeltaFIFO o. Cache

class Cache {
  +_items dict
  add(obj)
  delete(obj)
  update(obj)
  replace(objs)
  get(obj)
  get_by_key(key)
  list_keys()
  set_key_func(key_func)
}

class Producer {
  +_watch_resouce_type object
  +_lister_watcher ListerWatcher
  +_watch_timeout int
  +_store DeltaFIFO
  start()
  stop()  
}
DeltaFIFO ..o Producer
note bottom of Producer
ListerWatcher = namedtuple(
  'ListerWatcher',
  'list, watch')
end note

class Consumer {
  +_cache Cache
  +_fifo DeltaFIFO
  +_resource_event_handler ResouceEventHandler
  start()
  stop()
}
DeltaFIFO ..o Consumer
Cache ..o Consumer
note bottom of Consumer
ResouceEventHandler = namedtuple(
  'ResouceEventHandler',
  'on_add, on_delete, on_update')
end note
@enduml

PlantUML version 1.2017.16beta5(Unknown compile time)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.7.0_25-b15
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>